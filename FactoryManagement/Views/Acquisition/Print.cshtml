@**************************** Created By Jerin Jahan (Date:12.06.2017) *****************************************@
@model FactoryManagement.Models.View_Manual_Indent_Voucher
@{
    ViewBag.Title = "Indent Transaction Print";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var usenId = Convert.ToInt64(Request.Cookies["CookieAdminInfo"].Values["userid"]);
    var currency = Request.Cookies["CookieAdminInfo"].Values["currencySymbol"].ToString();
    FactoryManagement.Models.FactoryManagementEntities db = new FactoryManagement.Models.FactoryManagementEntities();
    var fact_info = db.FactoryInformations.FirstOrDefault();
    var allIndent = db.View_Manual_Indent.Where(m => m.VoucherId == Model.VoucherId).ToList();
    var allIndentTransactions = db.View_Indent_Transaction.Where(m => m.VoucherId == Model.VoucherId).OrderBy(m=>m.VoucherId).ToList();
    int count = 0;
}
<style>
    .headClass {
        margin-bottom: 20px;
    }
</style>

<div class="row headClass">
    <div class="col-md-12">
        <div class="col-xs-4 col-lg-4" style="float:left;text-align:left;">
            <div class="row">
                <div class="col-xs-12">
                    <span><img src="~/Images/Logo/GSML B&W LOGO.png" /></span>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <span>
                        Generated By:
                        @if (usenId > 0)
                        {
                            <span>@db.View_UserLists.Where(m => m.UserId == usenId).Select(m => m.UserName).FirstOrDefault()</span>
                        }
                        else
                        {
                            <span>Super Admin</span>
                        }
                    </span>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <span>
                        Generated Date:
                        @DateTime.Now.ToString("MMM dd, yyyy hh:mm tt")
                    </span>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-xs-4" style="text-align:center;">
            <div class="row">
                <div class="col-xs-12">
                    <h4>Indent Voucher</h4>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12" style="margin-top:-10px;">
                    <span>@fact_info.Name.Split('(')[0]</span>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-xs-4" style="text-align:right;">
            <div class="row" style="margin-top:-15px;">
                <div class="col-xs-12" style="font-size:25px;">
                    <h2><small>@Model.Name</small></h2>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <span>
                        @if (Model.CreatedBy != null)
                        {
                            if (Model.CreatedBy > 0)
                            {
                                <span>@Model.CreatedUserName</span><br />
                            }
                            else
                            {
                                <span>Super Admin</span><br />
                            }
                        }
                        else
                        {
                            <span>Created By Undefined</span><br />
                        }
                        
                    </span>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <span>
                        @if (Model.CreatedBy != null)
                        {
                        
                          <span>@Convert.ToDateTime(Model.CreatedDate).ToString("MMM dd,yyyy hh:mm tt")</span><br />  
                        }
                    </span>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <span style="float:right;margin-left:30px;font-weight:bold;">
                        Status: @if (Model.VoucherStatus != -1)
                        {
                            if (Model.VoucherStatus == 0)
                            {<span class="text-center text-warning">Pending Approval</span>}
                            if (db.ManualIndents.Where(m => m.VoucherId == Model.VoucherId && m.IndentStatus < 2 && m.IndentStatus != -1).Any() && Model.VoucherStatus != -1 && Model.VoucherStatus > 0)
                            {<span class="text-center text-info bold">Approved but not completed</span>
                            }
                            if (!db.ManualIndents.Where(m => m.VoucherId == Model.VoucherId && m.IndentStatus < 2 && m.IndentStatus != -1).Any() && Model.VoucherStatus != 2 && Model.VoucherStatus != -1)
                            {
                                <span class="text-center text-info bold">Partially Completed</span>
                            }
                            if (Model.VoucherStatus == 2)
                            {<span class="text-center text-success">Completed</span>}
                        }
                        else
                        {
                            <span style="color:red;">Deleted</span>
                        }
                    </span>
                </div>
            </div>

        </div>
    </div>
</div>
<div class="portlet light bordered">
    <div class="portlet-body form">
        <div class="form-horizontal">
            <div class="form-body">
                <table class="table table-bordered table-condensed" id="tbl_manu_indent_list">
                    <tbody>
                        <tr>
                            <th width="3%">#</th>
                            <th width="17%" style="font-weight:500!important;">Product Name</th>
                            <th width="10%" style="font-weight:500!important;">Request Qty</th>
                            <th width="10%" style="font-weight:500!important;">Received Qty</th>
                            <th width="10%" style="font-weight:500!important;">Per Unit Price</th>
                            <th width="20%" style="font-weight:500!important;">Updated By</th>
                            <th width="10%" style="font-weight:500!important;">Updated Date</th>
                        </tr>
                        @foreach (var item in allIndent)
                        {
                            count++;
                            double total_rcv_qty = 0;
                            if (db.ManualIndentReceiveTransactions.Where(m => m.VoucherId == item.VoucherId && m.IndentId == item.IndentId).Any())
                            {
                                total_rcv_qty = db.ManualIndentReceiveTransactions.Where(m => m.VoucherId == item.VoucherId && m.IndentId == item.IndentId).Sum(m => m.Quantity);
                            }
                            double remaing_qty = item.Quantity - total_rcv_qty;
                            <tr>
                                <td scope="row">@count.</td>
                                <td><span class="txtManuProName" data-id="@item.IndentId" style="color:#357ebd;cursor:pointer;">@item.ProName</span></td>
                                <td>@item.Quantity @item.UnitName</td>
                                <td>@total_rcv_qty @item.UnitName</td>
                                <td>@currency @item.ProUnitPrice</td>
                                <td>
                                    @if (item.UpdatedBy != null)
                                    {
                                        if (item.UpdatedBy > 0)
                                        {
                                            <img src="~/Images/UserPicture/thumb/@item.UpdateUserPic" class="img-circle" /> @item.UpdateUsername
                                        }
                                        else
                                        {
                                            <img src="~/Images/UserPicture/thumb/admin.jpg" class="img-circle" /><span>Super Admin</span>
                                        }
                                    }
                                    else
                                    {
                                        <span>Not Updated Yet</span>
                                    }
                                </td>
                                <td>
                                    @if (item.UpdatedBy != null)
                                    {
                                        @Convert.ToDateTime(item.UpdatedDateFormate).ToString("MMM dd,yyyy hh:mm tt")
                                    }
                                    else
                                    {
                                        <span>Not Updated Yet</span>
                                    }
                                </td>
                            </tr>
                        }

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
@if (allIndentTransactions.Count() > 0)
{
    <h4>Transactions List</h4>
    <div class="portlet light bordered">
        <div class="portlet-body form">
            <div class="form-horizontal">
                <div class="form-body">
                    <table class="table table-bordered table-condensed">
                        <tbody>
                            <tr>
                                <th>Transaction Name</th>
                                <th>Voucher Name</th>
                                <th>Product Name</th>
                                <th>Quantity</th>
                                <th>Inserted By</th>
                                <th>Inserted Date</th>
                            </tr>
                            @foreach (var item in allIndentTransactions)
                            {
                                <tr>

                                    <td>@item.TransactionName</td>
                                    <td>@item.Name</td>
                                    <td data-pid="@item.IndentId">@item.ProName</td>
                                    <td>@item.Quantity @item.UnitName</td>
                                    <td>
                                        @if (item.InsertedBy > 0)
                                        {
                                            <img src="~/Images/UserPicture/thumb/@item.InsertedUserPic" class="user-photo" />
                                            <a href="#" id="IdForUserDetails" data-uid="@item.InsertedBy"><span>@item.InsertedUserName</span></a>
                                        }
                                        else
                                        {
                                            <img src="~/Images/UserPicture/thumb/admin.jpg" class="user-photo" /><span>Super Admin</span>

                                        }
                                    </td>
                                    <td>@item.InsertedDateName</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
}
